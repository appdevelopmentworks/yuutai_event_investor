# 📅 開発ロードマップ

## プロジェクト概要

**プロジェクト名:** Yuutai Event Investor  
**開発期間:** 10週間（予定）  
**開発体制:** 個人開発  
**目標:** 株主優待イベント投資の最適タイミング予測ツールの完成と配布

---

## Phase 1: 基盤構築（Week 1-2）

### Week 1: プロジェクトセットアップ

**目標:** 開発環境とプロジェクト構造の確立

#### タスク
- [x] 要求定義書作成
- [ ] プロジェクトディレクトリ構成作成
- [ ] requirements.txt作成
- [ ] Git リポジトリ初期化
- [ ] 開発環境セットアップ（Python 3.10+, PySide6）

#### 成果物
- プロジェクト構造
- requirements.txt
- README.md（初期版）
- .gitignore

#### 技術検討事項
- [ ] QFluentWidgets vs qmaterial の選択
- [ ] qdarktheme の動作確認
- [ ] PyInstaller の動作テスト

---

### Week 2: データベース実装

**目標:** SQLiteデータベースの構築とテスト

#### タスク
- [ ] データベーススキーマ実装（create_tables.sql）
- [ ] database.py 実装
  - [ ] データベース接続管理
  - [ ] CRUD操作
  - [ ] トランザクション管理
- [ ] サンプルデータ投入
- [ ] 単体テスト作成

#### 成果物
- `src/core/database.py`
- `data/create_tables.sql`
- `tests/test_database.py`
- サンプルデータ

#### 検証ポイント
- [ ] データベース接続が正常に動作するか
- [ ] CRUD操作が正しく機能するか
- [ ] インデックスが適切に設定されているか

---

## Phase 2: コア機能実装（Week 3-4）

### Week 3: 計算エンジン実装

**目標:** バックテスト・期待値計算の実装

#### タスク
- [ ] 既存Streamlitコードの分析・リファクタリング
- [ ] ticker_utils.py 実装（checkTicker関数の移植）
- [ ] calculator.py 実装
  - [ ] 期待値計算ロジック
  - [ ] 勝率計算
  - [ ] 統計情報算出
- [ ] backtester.py 実装
  - [ ] バックテストエンジン
  - [ ] 権利付最終日の判定
  - [ ] 120日分のシミュレーション
- [ ] 単体テスト作成

#### 成果物
- `src/utils/ticker_utils.py`
- `src/core/calculator.py`
- `src/core/backtester.py`
- `tests/test_calculator.py`
- `tests/test_backtester.py`

#### 検証ポイント
- [ ] 既存Streamlitアプリと同等の計算結果が得られるか
- [ ] 計算速度は許容範囲か（120日分で数秒以内）
- [ ] エッジケースが正しく処理されるか

---

### Week 4: データ取得・キャッシュ機能

**目標:** yfinanceデータ取得とキャッシュシステム

#### タスク
- [ ] yfinanceデータ取得機能実装
  - [ ] 株価データ取得
  - [ ] エラーハンドリング
  - [ ] リトライ機能
- [ ] キャッシュシステム実装
  - [ ] price_history テーブルへの保存
  - [ ] simulation_cache の管理
  - [ ] キャッシュの有効期限管理
- [ ] config_manager.py 実装
  - [ ] JSON設定ファイル読み書き
  - [ ] デフォルト設定管理
- [ ] 単体テスト作成

#### 成果物
- データ取得モジュール
- `src/core/config_manager.py`
- `config/settings.json`（デフォルト設定）
- テストコード

#### 検証ポイント
- [ ] yfinanceからのデータ取得が安定しているか
- [ ] キャッシュが正しく機能するか
- [ ] エラー時の挙動は適切か

---

## Phase 3: UI実装（Week 5-6）

### Week 5: メインウィンドウとリスト表示

**目標:** アプリケーションの骨格UI作成

#### タスク
- [ ] main_window.py 実装
  - [ ] フレームレスウィンドウ
  - [ ] メニューバー
  - [ ] ステータスバー
  - [ ] レイアウト構成
- [ ] stock_list_widget.py 実装
  - [ ] 銘柄リスト表示
  - [ ] ソート機能
  - [ ] 選択イベント
- [ ] filter_widget.py 実装（基本部分）
  - [ ] 権利確定月フィルター
  - [ ] 勝率スライダー
  - [ ] 期待リターンスライダー
- [ ] テーマ切替機能
  - [ ] qdarktheme 統合
  - [ ] ダーク/ライト自動切替

#### 成果物
- `src/ui/main_window.py`
- `src/ui/stock_list_widget.py`
- `src/ui/filter_widget.py`
- `main.py`

#### 検証ポイント
- [ ] ウィンドウが正常に表示されるか
- [ ] リサイズ・最小化・最大化が機能するか
- [ ] テーマ切替がスムーズか
- [ ] フィルター機能が動作するか

---

### Week 6: 詳細パネルとチャート表示

**目標:** 銘柄詳細の可視化機能

#### タスク
- [ ] detail_panel.py 実装
  - [ ] 銘柄情報カード
  - [ ] 統計情報表示
  - [ ] タブ切替（グラフ/詳細データ）
- [ ] chart_widget.py 実装
  - [ ] matplotlib統合
  - [ ] 折れ線グラフ（期待値推移）
  - [ ] 棒グラフ（勝率）
  - [ ] 散布図（勝ち負け）
  - [ ] グラフ切替機能
- [ ] アニメーション効果追加
  - [ ] パネル切替アニメーション
  - [ ] チャート描画アニメーション

#### 成果物
- `src/ui/detail_panel.py`
- `src/ui/chart_widget.py`
- 改善されたグラフ表示

#### 検証ポイント
- [ ] グラフが正しく表示されるか
- [ ] グラフの切替がスムーズか
- [ ] 大量データでも描画が遅くないか
- [ ] アニメーションが自然か

---

## Phase 4: スクレイピング実装（Week 7）

### Week 7: データ収集機能

**目標:** 優待データのスクレイピング実装

#### タスク
- [ ] scraping_config.json 作成
  - [ ] 96ut.com の設定
  - [ ] yutai.net-ir.ne.jp の設定
- [ ] base_scraper.py 実装
  - [ ] スクレイパー基底クラス
  - [ ] 共通機能（リトライ、エラーハンドリング）
- [ ] scraper_96ut.py 実装
  - [ ] 96ut.comからのデータ取得
  - [ ] HTMLパース
  - [ ] データ抽出
- [ ] scraper_netir.py 実装
  - [ ] yutai.net-ir.ne.jpからのデータ取得
  - [ ] HTMLパース
  - [ ] データ抽出
- [ ] data_validator.py 実装
  - [ ] データ検証
  - [ ] 異常値チェック
- [ ] エラーログ記録機能
- [ ] UI統合（更新ボタン）

#### 成果物
- `config/scraping_config.json`
- `src/scraping/base_scraper.py`
- `src/scraping/scraper_96ut.py`
- `src/scraping/scraper_netir.py`
- `src/scraping/data_validator.py`
- `src/utils/logger.py`

#### 検証ポイント
- [ ] 両サイトから正しくデータ取得できるか
- [ ] エラー時にフォールバックセレクターが機能するか
- [ ] 取得データの妥当性チェックが動作するか
- [ ] エラーログが適切に記録されるか

---

## Phase 5: 追加機能（Week 8）

### Week 8: ウォッチリスト・通知・エクスポート

**目標:** 便利機能の実装

#### タスク
- [ ] ウォッチリスト機能
  - [ ] 追加/削除UI
  - [ ] ウォッチリスト専用タブ
  - [ ] メモ編集機能
- [ ] notifier.py 実装
  - [ ] 通知チェック機能
  - [ ] 通知送信（Windows/macOS/Linux対応）
  - [ ] バックグラウンド実行
- [ ] export.py 実装
  - [ ] CSV出力
  - [ ] スクリーンショット保存
  - [ ] 設定エクスポート/インポート
- [ ] settings_dialog.py 実装
  - [ ] 設定画面UI
  - [ ] 各種設定項目
  - [ ] 設定の保存

#### 成果物
- ウォッチリスト機能
- `src/core/notifier.py`
- `src/utils/export.py`
- `src/ui/settings_dialog.py`

#### 検証ポイント
- [ ] ウォッチリストが正常に動作するか
- [ ] 通知が適切なタイミングで発火するか
- [ ] エクスポート機能が正しく動作するか
- [ ] 設定が保存・復元されるか

---

## Phase 6: 配布準備（Week 9-10）

### Week 9: テスト・デバッグ

**目標:** 品質保証とバグ修正

#### タスク
- [ ] 統合テスト
  - [ ] 全機能の動作確認
  - [ ] エッジケーステスト
  - [ ] パフォーマンステスト
- [ ] バグ修正
  - [ ] クリティカルバグ
  - [ ] UIの不具合
  - [ ] データ整合性の問題
- [ ] ユーザビリティ改善
  - [ ] UI/UXの微調整
  - [ ] エラーメッセージの改善
  - [ ] ツールチップ追加
- [ ] ドキュメント作成
  - [ ] ユーザーマニュアル
  - [ ] README.md 更新
  - [ ] CHANGELOG.md 作成

#### 成果物
- テストレポート
- 修正済みアプリケーション
- ユーザーマニュアル

#### 検証ポイント
- [ ] 主要な機能が全て動作するか
- [ ] クラッシュやフリーズがないか
- [ ] メモリリークがないか
- [ ] ドキュメントが分かりやすいか

---

### Week 10: ビルド・リリース

**目標:** 配布可能なアプリケーション作成

#### タスク
- [ ] PyInstaller設定
  - [ ] .specファイル作成
  - [ ] リソースファイルの組み込み
  - [ ] onefolder形式でビルド
- [ ] ビルドテスト
  - [ ] Windows環境でテスト
  - [ ] 依存関係の確認
  - [ ] 動作確認
- [ ] インストーラー作成（オプション）
  - [ ] Inno Setup 検討
- [ ] リリースパッケージ作成
  - [ ] ZIPファイル作成
  - [ ] README同梱
  - [ ] ライセンス表記
- [ ] リリースノート作成

#### 成果物
- 配布可能な実行ファイル
- インストーラー（オプション）
- リリースパッケージ
- リリースノート

#### 検証ポイント
- [ ] クリーンな環境で起動するか
- [ ] 全ての機能が正常に動作するか
- [ ] ファイルサイズは適切か
- [ ] 起動速度は許容範囲か

---

## マイルストーン

| マイルストーン | 期限 | 成果物 | 状態 |
|------------|------|--------|------|
| Phase 1完了 | Week 2 | 開発環境・DB | ⏳ 予定 |
| Phase 2完了 | Week 4 | コア機能 | ⏳ 予定 |
| Phase 3完了 | Week 6 | UI実装 | ⏳ 予定 |
| Phase 4完了 | Week 7 | スクレイピング | ⏳ 予定 |
| Phase 5完了 | Week 8 | 追加機能 | ⏳ 予定 |
| Phase 6完了 | Week 10 | リリース | ⏳ 予定 |

---

## リスク管理

### 技術的リスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| スクレイピング対象サイトの仕様変更 | 高 | 中 | フォールバックセレクター実装、エラーログ記録 |
| yfinance APIの不安定性 | 中 | 中 | リトライ機能、キャッシュ活用 |
| PyInstaller ビルドエラー | 中 | 低 | 早期テスト、代替案（Nuitka）検討 |
| パフォーマンス問題 | 中 | 低 | プロファイリング、最適化 |

### スケジュールリスク

| リスク | 影響度 | 発生確率 | 対策 |
|--------|--------|---------|------|
| 見積もりの甘さ | 高 | 中 | バッファ期間の確保、MVP優先 |
| 機能追加の膨張 | 中 | 高 | スコープ管理、Phase 6での機能追加禁止 |

---

## 開発優先順位

### 必須機能（MVP）
1. 銘柄リスト表示・ソート
2. 最適買入日の自動計算
3. 個別銘柄の詳細分析
4. フィルター機能
5. データ更新（スクレイピング）

### 重要機能
1. ウォッチリスト
2. CSV出力
3. 通知機能
4. 設定インポート/エクスポート

### あると嬉しい機能
1. スクリーンショット
2. アニメーション効果
3. ツールチップ
4. ショートカットキー

---

## 次週のアクション

**Week 1の具体的なタスク:**

### Day 1-2: プロジェクト構成作成
- [ ] ディレクトリ構造作成
- [ ] `requirements.txt` 作成
- [ ] `.gitignore` 作成
- [ ] Git初期化

### Day 3-4: 環境セットアップ
- [ ] PySide6インストール
- [ ] QFluentWidgets vs qmaterial 検証
- [ ] qdarktheme 動作確認
- [ ] Hello World アプリ作成

### Day 5-7: データベース設計
- [ ] `create_tables.sql` 作成
- [ ] `database.py` 基本実装
- [ ] データベース接続テスト
- [ ] サンプルデータ投入

---

## 進捗管理

進捗は以下で管理：
- GitHub Issues（機能単位）
- GitHub Projects（カンバンボード）
- docs/progress.md（週次レポート）

---

## 完成の定義（Definition of Done）

各Phaseは以下の条件を満たした時点で完了とする：

1. ✅ 全タスクが完了
2. ✅ 単体テストが全てパス
3. ✅ ドキュメントが更新されている
4. ✅ コードレビューが完了（セルフレビュー）
5. ✅ 次Phaseに影響する既知の問題がない

プロジェクト全体は以下の条件で完了：

1. ✅ MVP機能が全て実装されている
2. ✅ 主要なバグが修正されている
3. ✅ PyInstallerでビルドできる
4. ✅ ユーザーマニュアルが完成している
5. ✅ リリースノートが作成されている

---

## 備考

- 本ロードマップは開発状況に応じて柔軟に調整する
- 週次で進捗を確認し、必要に応じてスケジュールを見直す
- MVP完成後、ユーザーフィードバックを受けて機能追加を検討
