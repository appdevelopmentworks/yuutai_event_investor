# 実データ取得・運用ガイド

## 概要

本アプリケーションを実際の投資分析に使用するための実データ取得方法をまとめたガイドです。

---

## 方法1: 主要銘柄CSVテンプレートを使う（最も簡単）

### 手順

1. **CSVテンプレートを作成**
   ```bash
   python scripts/create_yuutai_csv_template.py
   ```

2. **作成されたCSVファイルを確認**
   - ファイル: `data/major_yuutai_stocks.csv`
   - 含まれる銘柄数: 13件
   - 主要な優待銘柄（JT、イオン、KDDI、ANAなど）

3. **アプリでインポート**
   - アプリを起動
   - 「ファイル」→「CSVから銘柄をインポート」（Ctrl+I）
   - `data/major_yuutai_stocks.csv` を選択
   - 「インポート開始」をクリック

### 含まれる銘柄

| 銘柄コード | 銘柄名 | 権利確定月 | 優待内容 |
|----------|--------|-----------|---------|
| 8267 | イオン | 2月 | イオンギフトカード |
| 2914 | 日本たばこ産業（JT） | 12月 | 自社グループ商品（2,500円相当） |
| 7201 | トヨタ自動車 | 3月 | カタログギフト |
| 8001 | 伊藤忠商事 | 3月・9月 | カタログギフト（3,000円相当） |
| 8031 | 三井物産 | 3月 | 自社グループ商品 |
| 8058 | 三菱商事 | 3月 | カタログギフト |
| 8304 | あおぞら銀行 | 3月 | QUOカード（500円） |
| 8306 | 三菱UFJフィナンシャル・グループ | 3月 | カタログギフト |
| 8591 | オリックス | 3月 | カタログギフト（株主カード） |
| 9202 | ANAホールディングス | 3月 | 株主優待券（50%割引） |
| 9433 | KDDI | 3月 | カタログギフト（3,000円相当） |

---

## 方法2: 証券会社のデータを活用

### 推奨される証券会社サイト

#### 1. SBI証券
- **URL**: https://search.sbisec.co.jp/v2/popwin/info/stock/pop6040_yutai_list.html
- **特徴**:
  - 優待銘柄一覧が充実
  - 権利確定月で絞り込み可能
  - Excel形式でダウンロード可能（一部）

#### 2. 楽天証券
- **URL**: https://www.rakuten-sec.co.jp/web/special/yutai/
- **特徴**:
  - 見やすい優待一覧
  - 検索機能が充実
  - スクリーンショットして手動入力も可能

#### 3. マネックス証券
- **URL**: https://info.monex.co.jp/yutai/index.html
- **特徴**:
  - 詳細な優待情報
  - 月別検索可能

### データ取得の流れ

1. **証券会社サイトにアクセス**
2. **優待銘柄一覧ページを表示**
3. **必要なデータをコピー**
   - 銘柄コード
   - 銘柄名
   - 権利確定日（月）
4. **Excelに貼り付け**
5. **CSV形式で保存**
6. **アプリでインポート**

### Excelでの編集例

```
| code | name | rights_month | rights_date | yuutai_genre | yuutai_content | min_investment |
|------|------|--------------|-------------|--------------|----------------|----------------|
| 8267 | イオン | 2 | 2025-02-28 | 買物券 | イオンギフトカード | 200000 |
| 9433 | KDDI | 3 | 2025-03-31 | カタログ | カタログギフト | 200000 |
```

**保存形式**: CSV UTF-8（カンマ区切り）

---

## 方法3: Yahoo!ファイナンスから取得

### 手順

1. **Yahoo!ファイナンスの優待検索にアクセス**
   - URL: https://finance.yahoo.co.jp/shareholder/search

2. **条件を設定**
   - 権利確定月を選択
   - 検索実行

3. **結果をコピー**
   - ブラウザの表示をコピー
   - Excelに貼り付け

4. **必要なカラムに変換**
   - 銘柄コード → `code`
   - 銘柄名 → `name`
   - 権利確定月 → `rights_month`
   - 権利確定日 → `rights_date`（月末を仮定）

5. **CSV保存してインポート**

---

## 方法4: 手動入力

少数の銘柄を分析したい場合は手動入力が最も確実です。

### 手順

1. **テンプレートCSVをコピー**
   ```bash
   copy data\csv_format_example.csv data\my_stocks.csv
   ```

2. **Excelまたはテキストエディタで編集**
   ```csv
   code,name,rights_month,rights_date,yuutai_genre,yuutai_content,min_investment
   8001,伊藤忠商事,3,2025-03-31,金券,カタログギフト,300000
   ```

3. **アプリでインポート**

### 必須カラム

- `code`: 銘柄コード（4桁）
- `name`: 銘柄名
- `rights_date`: 権利確定日（YYYY-MM-DD形式）

### オプションカラム

- `rights_month`: 権利確定月（1-12、省略時は自動判定）
- `yuutai_genre`: 優待ジャンル
- `yuutai_content`: 優待内容
- `min_investment`: 最低投資金額

---

## 権利確定日の調べ方

### 方法1: 証券会社サイト

**SBI証券の場合:**
1. 銘柄コードで検索
2. 「企業情報」タブ
3. 「株主優待」セクションに記載

### 方法2: 企業のIRページ

1. 企業の公式サイトにアクセス
2. 「IR情報」または「株主・投資家の皆様へ」
3. 「株主優待」のページを確認

### 方法3: Yahoo!ファイナンス

1. https://finance.yahoo.co.jp/
2. 銘柄コードで検索
3. 「株主優待」タブを表示

---

## 配当銘柄の追加

株主優待がない配当銘柄も、権利確定日前の株価上昇を分析できます。

### 例: 高配当株

```csv
code,name,rights_month,rights_date,yuutai_genre,yuutai_content,min_investment
8058,三菱商事,3,2025-03-31,配当,年間配当220円,500000
8316,三井住友FG,3,2025-03-31,配当,年間配当280円,500000
8411,みずほFG,3,2025-03-31,配当,年間配当90円,200000
```

**重要**: `yuutai_genre`を「配当」として、`yuutai_content`に配当金額を記載

---

## 実運用のワークフロー

### 初回セットアップ

1. **主要銘柄をインポート**
   ```bash
   python scripts/create_yuutai_csv_template.py
   ```
   - アプリで `data/major_yuutai_stocks.csv` をインポート

2. **追加銘柄を手動で入力**
   - 興味のある銘柄をCSVに追加
   - 再度インポート

3. **バックテスト実行**
   - 各銘柄を選択すると自動的にバックテスト実行
   - または「ツール」→「データ更新」で一括実行

### 定期メンテナンス

**頻度: 3ヶ月に1回**

1. **新規優待銘柄の確認**
   - 証券会社のニュースをチェック
   - 新規優待発表を確認

2. **権利確定日の変更確認**
   - 企業のIR情報をチェック
   - 権利確定日が変更されていないか確認

3. **CSVファイルを更新**
   - 新規銘柄を追加
   - 廃止された優待を削除

4. **再インポート**
   - 「既存の銘柄データを上書きする」にチェック
   - 最新データで上書き

---

## トラブルシューティング

### Q1: 権利確定日がわからない

**A**: 以下の順で確認
1. Yahoo!ファイナンスで銘柄検索
2. 「株主優待」タブを表示
3. 記載がない場合は企業のIRページを確認
4. それでも不明な場合は月末（3月なら3/31）を仮入力

### Q2: バックテストが実行されない

**A**: 以下を確認
1. 権利確定日が正しく入力されているか
2. インターネット接続（株価データ取得に必要）
3. 銘柄コードが正しいか（yfinanceで取得可能か）

### Q3: データが古くなった

**A**: データの更新方法
1. 最新のCSVファイルを作成
2. 「既存の銘柄データを上書きする」でインポート
3. 必要に応じてシミュレーションキャッシュをクリア

---

## おすすめの運用方法

### ステップ1: 主要銘柄から開始

まずは提供されている主要13銘柄から始めましょう。

```bash
python scripts/create_yuutai_csv_template.py
```

### ステップ2: 興味のある銘柄を追加

証券会社のサイトやYahoo!ファイナンスで興味のある銘柄を見つけたら、CSV形式で追加します。

### ステップ3: バックテスト結果を確認

各銘柄を選択してバックテスト結果を確認。最適買入日、勝率、期待リターンをチェック。

### ステップ4: ウォッチリストに登録

良い結果が出た銘柄をウォッチリストに追加。メモ機能で投資戦略を記録。

### ステップ5: 定期的に見直し

3ヶ月に1回程度、データを更新して再分析。

---

## データの信頼性について

### 株価データ

- **ソース**: yfinance（Yahoo! Financeのデータ）
- **信頼性**: 高い（多くの投資家が利用）
- **更新頻度**: リアルタイム〜1日遅れ

### 優待情報

- **ソース**: ユーザーが手動で入力・更新
- **信頼性**: 情報源による（証券会社のデータは信頼性高）
- **更新頻度**: ユーザー任意

**重要**: 優待情報は企業の公式発表を最終確認してください。

---

## まとめ

実データ運用のポイント:

1. ✅ **まずは主要銘柄から**: テンプレートCSVで13銘柄からスタート
2. ✅ **証券会社データを活用**: SBI証券、楽天証券などから情報取得
3. ✅ **定期的に更新**: 3ヶ月に1回程度メンテナンス
4. ✅ **配当銘柄も分析可**: 優待がなくても権利確定日前の上昇を分析
5. ✅ **公式情報を確認**: 投資判断は企業の公式発表を基に

**注意**: 本ツールはあくまで分析支援ツールです。投資判断は自己責任で行ってください。

---

**最終更新**: 2025-11-07
**バージョン**: 1.0.0
