# TODO リスト - Yuutai Event Investor

最終更新: 2025-11-07

---

## ✅ 完了済み（MVP達成）

### Phase 1: 基盤構築
- [x] プロジェクトディレクトリ構成作成
- [x] requirements.txt作成
- [x] データベーススキーマ実装（v2.0.0 - 複合主キー対応）
- [x] database.py 実装
  - [x] データベース接続管理
  - [x] CRUD操作
  - [x] 複合主キー (code, rights_month) 対応
  - [x] get_stock(), get_stocks_by_code() メソッド
- [x] マイグレーションスクリプト (migrate_to_v2.py)
- [x] サンプルデータ投入（2,224件の優待銘柄）

### Phase 2: コア機能実装
- [x] calculator.py 実装
  - [x] 期待値計算ロジック
  - [x] 勝率計算
  - [x] 統計情報算出
- [x] backtester.py 実装
  - [x] バックテストエンジン
  - [x] 権利付最終日の判定
  - [x] 120日分のシミュレーション
- [x] yfinanceデータ取得機能
- [x] キャッシュシステム実装
  - [x] price_history テーブル
  - [x] simulation_cache テーブル

### Phase 3: UI実装
- [x] main_window_v3.py 実装（現行版）
  - [x] メインウィンドウ
  - [x] メニューバー
  - [x] ステータスバー
  - [x] 起動時ウィンドウサイズ最適化 (2000x1500)
- [x] stock_list_widget.py 実装
  - [x] 銘柄リスト表示
  - [x] ソート機能
  - [x] 選択イベント
  - [x] バックテスト結果の表示（勝率、期待リターン）
- [x] filter_panel.py 実装
  - [x] 権利確定月フィルター
  - [x] 勝率スライダー
  - [x] 期待リターンスライダー
  - [x] 上限投資金額フィルター
- [x] detail_panel.py 実装
  - [x] 銘柄情報カード（6つの指標）
  - [x] 統計情報表示
  - [x] チャート切替
- [x] chart_widget.py 実装
  - [x] matplotlib統合
  - [x] 折れ線グラフ（期待値推移）
  - [x] 棒グラフ（勝率）
  - [x] 散布図（勝ち負け）
  - [x] 日本語フォント設定
- [x] ウォッチリスト機能
  - [x] 追加/削除UI
  - [x] ウォッチリスト専用タブ

### Phase 4: スクレイピング実装
- [x] スクレイピングシステム設計
  - [x] 抽象基底クラス (base_scraper.py)
  - [x] 外部設定ファイル (selectors.json)
  - [x] フォールバック戦略
- [x] scraper_kabuyutai.py 実装（主要ソース）
  - [x] kabuyutai.com からのデータ取得
  - [x] 企業名クリーニング
  - [x] ジャンル推定
- [x] scraper_yutai_net.py 実装
- [x] scraper_96ut.py 実装
- [x] scraper_manager.py 実装
  - [x] 複数スクレイパー統合管理
  - [x] 優先順位制御
  - [x] 重複除去
- [x] データ取得スクリプト
  - [x] fetch_all_yuutai_stocks.py（DB直接保存）
  - [x] export_yuutai_to_csv.py（CSV出力のみ）
- [x] 東証全銘柄対応
  - [x] update_stock_names.py（正式名称への変換）

### Phase 5: 追加機能
- [x] CSVインポート/エクスポート
  - [x] csv_importer.py（複合主キー対応）
  - [x] import_yuutai_csv.py（コマンドライン版）
- [x] データベースマイグレーション
  - [x] create_tables_v2.sql
  - [x] migrate_to_v2.py
- [x] バックグラウンド処理
  - [x] AnalysisWorker（QThread）
  - [x] バックテスト並列処理

### ドキュメント
- [x] README.md（基本情報、使い方）
- [x] SCRAPING_ARCHITECTURE.md（スクレイピング設計書）
- [x] SCRAPING_USAGE.md（スクレイピング使用方法）
- [x] YUUTAI_DATA_UPDATE.md（データ更新ガイド）
- [x] CLAUDE.md（開発ガイド）
- [x] database_schema.md（DB設計書）
- [x] roadmap.md（開発ロードマップ）

### バグ修正
- [x] pandas FutureWarning修正
- [x] グリッド更新の同期問題修正
- [x] closeEvent AttributeError修正
- [x] CSVエクスポートエンコーディングエラー修正

---

## 🚧 進行中

なし

---

## ⏳ 未実装・要確認

### 高優先度

#### 1. 動作確認とバグ修正
- [ ] 全機能の統合テスト
- [ ] エラーハンドリングの確認
- [ ] メモリリーク確認
- [ ] パフォーマンステスト
  - [ ] 大量データ（2000件以上）での動作確認
  - [ ] バックテスト計算速度確認

#### 2. 配布準備
- [ ] PyInstaller設定
  - [ ] .specファイル作成
  - [ ] リソースファイルの組み込み
  - [ ] onefolder形式でビルド
- [ ] ビルドテスト
  - [ ] Windows環境でテスト
  - [ ] 依存関係の確認
  - [ ] クリーンな環境での動作確認
- [ ] リリースパッケージ作成
  - [ ] ZIPファイル作成
  - [ ] README同梱
  - [ ] ライセンス表記

### 中優先度

#### 3. 機能の確認・改善
- [ ] 通知機能の動作確認
  - [ ] デスクトップ通知（Windows/macOS/Linux）
  - [ ] 通知スケジューラー
- [ ] エクスポート機能の確認
  - [ ] スクリーンショット保存
  - [ ] PDF出力
  - [ ] 設定のエクスポート/インポート

#### 4. ユーザビリティ改善
- [ ] ツールチップ追加
- [ ] ショートカットキー実装
- [ ] エラーメッセージの改善
- [ ] プログレスバー追加（長時間処理）
- [ ] ローディング表示改善

#### 5. ドキュメント整備
- [ ] ユーザーマニュアル（詳細版）
- [ ] トラブルシューティングガイド
- [ ] スクリーンショット付き操作ガイド
- [ ] FAQ作成
- [ ] CHANGELOG.md作成
- [ ] リリースノート作成

### 低優先度

#### 6. 追加機能（あると嬉しい）
- [ ] より高度なフィルター
  - [ ] 複数条件の組み合わせ
  - [ ] フィルター設定の保存/読込
- [ ] カスタムレポート機能
- [ ] データ可視化の強化
  - [ ] ヒートマップ
  - [ ] 相関分析
- [ ] バッチ処理機能
  - [ ] 複数銘柄の一括バックテスト
- [ ] 設定画面の拡充
  - [ ] テーマカスタマイズ
  - [ ] 計算パラメータ調整

#### 7. パフォーマンス最適化
- [ ] データベースクエリ最適化
- [ ] キャッシュ戦略の見直し
- [ ] UI描画の最適化

#### 8. テストコード
- [ ] 単体テスト拡充
  - [ ] test_database.py
  - [ ] test_calculator.py
  - [ ] test_csv_importer.py
- [ ] 統合テスト追加

---

## 🐛 既知の問題

なし（現在報告されている問題はありません）

---

## 📊 進捗サマリ

### 全体進捗: 約90%完了

- **Phase 1 (基盤構築)**: 100% ✅
- **Phase 2 (コア機能)**: 100% ✅
- **Phase 3 (UI実装)**: 100% ✅
- **Phase 4 (スクレイピング)**: 100% ✅
- **Phase 5 (追加機能)**: 80% 🚧
- **Phase 6 (配布準備)**: 0% ⏳

### MVP達成状況: ✅ 完了

必須機能は全て実装済み：
1. ✅ 銘柄リスト表示・ソート
2. ✅ 最適買入日の自動計算
3. ✅ 個別銘柄の詳細分析
4. ✅ フィルター機能
5. ✅ データ更新（スクレイピング）

---

## 🎯 次のアクション

### 今週中に実施すべきこと

1. **全機能の動作確認**（1-2時間）
   - 各機能を実際に操作して確認
   - エラーが出る箇所のリストアップ

2. **PyInstallerでのビルドテスト**（2-3時間）
   - .specファイルの作成
   - ビルド実行
   - 動作確認

3. **ドキュメント整備**（2-3時間）
   - スクリーンショット撮影
   - ユーザーマニュアルの作成

### 来週以降

1. **リリース準備**
   - リリースパッケージ作成
   - リリースノート作成
   - 配布

2. **ユーザーフィードバック収集**
   - 改善点の洗い出し
   - 次バージョンの計画

---

## 📝 メモ

### 技術的な決定事項
- データベース: SQLite3
- UI: PySide6 (Qt6)
- チャート: matplotlib
- スクレイピング: BeautifulSoup4 + requests
- 複合主キー: (code, rights_month) - v2.0.0で実装

### データ統計
- 総銘柄数: 2,224件
- 複数月優待銘柄: 536件
- 月別最多: 3月（849件）

### リソース
- データソース: kabuyutai.com（主要）、yutai.net-ir.ne.jp、96ut.com
- 株価データ: Yahoo Finance (yfinance)
- 東証全銘柄: data/東証全銘柄.csv

---

## 🔄 変更履歴

### 2025-11-07
- [x] データベーススキーマをv2.0.0に更新（複合主キー対応）
- [x] 全月データ（2,224件）を再インポート
- [x] CSVインポート機能を複合主キー対応に修正
- [x] 起動時ウィンドウサイズを2000x1500に変更
- [x] closeEvent AttributeError修正
- [x] スクレイピング機能完成（3サイト対応）
- [x] 東証全銘柄による正式名称変換機能追加
