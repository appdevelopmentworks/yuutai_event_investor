# 📁 CSVインポート機能ガイド

## 概要

CSVファイルから銘柄リストをインポートすることで、株主優待銘柄だけでなく、配当目的の銘柄も分析対象に追加できます。

---

## 使い方

### 1. CSVファイルを準備

以下のフォーマットでCSVファイルを作成します。

#### 必須カラム

| カラム名 | 説明 | 形式 | 例 |
|---------|------|------|-----|
| `code` | 銘柄コード | 4桁の数字 | 8001 |
| `name` | 銘柄名 | 文字列 | 伊藤忠商事 |
| `rights_date` | 権利確定日 | YYYY-MM-DD | 2025-03-31 |

#### オプションカラム

| カラム名 | 説明 | デフォルト値 | 例 |
|---------|------|------------|-----|
| `rights_month` | 権利確定月 | 権利確定日から自動判定 | 3 |
| `yuutai_genre` | 優待ジャンル | その他 | 金券・ギフト |
| `yuutai_content` | 優待内容 | 空文字 | カタログギフト（3000円相当） |
| `min_investment` | 最低投資金額（円） | 0 | 300000 |

### 2. サンプルCSV

`data/csv_format_example.csv`にサンプルファイルがあります。

```csv
code,name,rights_month,rights_date,yuutai_genre,yuutai_content,min_investment
8001,伊藤忠商事,3,2025-03-31,金券・ギフト,カタログギフト（3000円相当）,300000
8031,三井物産,3,2025-03-31,食品,自社グループ商品,300000
8058,三菱商事,3,2025-03-31,金券・ギフト,カタログギフト,500000
9202,ANA HD,3,2025-03-31,交通,株主優待券（50%割引）,200000
```

### 3. インポート手順

1. **メニューから開く**
   - 「ファイル」→「CSVから銘柄をインポート」を選択
   - または `Ctrl+I` を押す

2. **CSVファイルを選択**
   - 「参照」ボタンをクリック
   - CSVファイルを選択

3. **オプションを設定**
   - 「既存の銘柄データを上書きする」にチェックを入れると、同じ銘柄コードがある場合に上書き
   - チェックを外すと、既存銘柄はスキップされる

4. **インポート開始**
   - 「インポート開始」ボタンをクリック
   - 進捗バーで進行状況を確認

5. **結果確認**
   - 成功件数、スキップ件数、エラー件数が表示される
   - エラーがある場合は詳細が表示される

---

## ユースケース

### ケース1: 配当銘柄を追加

高配当株を分析したい場合：

```csv
code,name,rights_month,rights_date,yuutai_genre,yuutai_content,min_investment
8058,三菱商事,3,2025-03-31,配当,年間配当220円,500000
8306,三菱UFJ,3,2025-03-31,配当,年間配当50円,100000
8316,三井住友FG,3,2025-03-31,配当,年間配当280円,500000
```

### ケース2: 優待＋配当のハイブリッド銘柄

```csv
code,name,rights_month,rights_date,yuutai_genre,yuutai_content,min_investment
8267,イオン,2,2025-02-28,買物券・配当,イオンギフトカード＋配当,200000
9433,KDDI,3,2025-03-31,カタログ・配当,カタログギフト＋配当,200000
```

### ケース3: 一括で複数銘柄を追加

Excelなどで銘柄リストを管理している場合、CSV形式で保存してインポート可能。

---

## 注意事項

### ファイル形式

- **文字エンコーディング**: UTF-8（BOM付きも可）
- **ファイル拡張子**: `.csv`
- **区切り文字**: カンマ (`,`)

### データ検証

インポート時に以下がチェックされます：

1. **必須カラムの存在確認**
   - `code`, `name`, `rights_date` が必須

2. **銘柄コードの形式**
   - 4桁の数字（例: 8001）

3. **権利確定日の形式**
   - `YYYY-MM-DD` 形式（例: 2025-03-31）

4. **権利確定月の範囲**
   - 1〜12の範囲

5. **最低投資金額の形式**
   - 数値であること

### エラーの対処

#### エラー例1: 「必須カラムが不足しています」

**原因**: CSVファイルに`code`, `name`, `rights_date`のいずれかが含まれていない

**解決策**: CSVファイルを編集して、必須カラムを追加

#### エラー例2: 「権利確定日の形式が不正です」

**原因**: 権利確定日が`YYYY-MM-DD`形式ではない

**例**:
- ❌ `2025/3/31`（スラッシュ区切り）
- ❌ `03-31-2025`（月-日-年の順序）
- ✅ `2025-03-31`（正しい形式）

**解決策**: Excelで日付形式を変更するか、テキストエディタで修正

#### エラー例3: 「文字エンコーディングエラー」

**原因**: CSVファイルがUTF-8ではない

**解決策**:
- Excelの場合: 「CSV UTF-8（カンマ区切り）」で保存
- テキストエディタの場合: UTF-8エンコーディングで保存

---

## Tips

### Excel から CSV へ変換

1. Excelで銘柄リストを作成
2. 「名前を付けて保存」
3. ファイルの種類: **「CSV UTF-8（カンマ区切り）」** を選択
4. 保存

### 既存データの更新

既存の銘柄データを更新したい場合：

1. 現在のデータをCSVエクスポート（「ファイル」→「エクスポート」→「CSVにエクスポート」）
2. Excelなどで編集
3. 「既存の銘柄データを上書きする」にチェックを入れてインポート

### 大量の銘柄をインポート

100銘柄以上をインポートする場合：

- インポートには数分かかる場合があります
- バックテストは別途実行する必要があります
  - 「ツール」→「データ更新」でバックテストを実行

---

## トラブルシューティング

### Q1: インポート後、銘柄が表示されない

**A**: アプリケーションを再起動するか、フィルターをリセットしてください。

### Q2: バックテスト結果が表示されない

**A**: インポート直後はシミュレーションキャッシュがありません。銘柄を選択すると自動的にバックテストが実行されます。

### Q3: 同じ銘柄を何度もインポートしてしまった

**A**: 「既存の銘柄データを上書きする」のチェックを外せば、重複インポートを防げます。

---

## サンプルファイル

プロジェクト内の`data/csv_format_example.csv`にサンプルが含まれています。

このファイルをコピーして、ご自身の銘柄リストを作成してください。

---

## まとめ

CSVインポート機能を使えば：

- ✅ 株主優待銘柄に加えて、配当銘柄も分析可能
- ✅ 既存のExcel管理データをそのまま活用
- ✅ 大量の銘柄を一括登録
- ✅ 柔軟な銘柄管理

権利確定日前の株価上昇を分析して、最適な買入タイミングを見つけましょう！

---

**最終更新**: 2025-11-07
**バージョン**: 1.0.0
